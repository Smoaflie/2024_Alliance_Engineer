# 湖南大学RoboMaster电控组通信协议

<p align='right'>Seasky LIUWei</p>

<p align='right'>modified by neozng1@hnu.edu.cn</p>

可用于视觉，以及其他自研模块（仅限串口通信）

> TODO:
>
> 1. 利用F4自带的硬件CRC模块计算校验码，提高速度
> 2. 增加更多的数据类型支持，使得数据类型也为可配置的

## 一、串口配置

通信方式是串口，配置为波特率 921600，8 位数据位，1 位停止位，无硬件流控，无校验位。

## 二、数据帧说明

以下所有低位在前发送，数据长度可变。

1. 通信协议格式

   | 帧头                     | 数据          | 帧尾                                |
   | ----------------------- | ------------- | :---------------------------------- |
   | protocol_header(3-byte) | data (n-byte) | frame_tail(1-byte，CRC8，整包校验)   |

2. 帧头详细定义

   | 帧头        | 偏移位置 | 字节大小 | 内容                          |
   | ----------- | -------- | -------- | ----------------------------- |
   | sof(CMD)    | 0        | 1        | 数据帧起始字节，固定值为 0xff  |  //不同兵种不同帧头ID 后期如果不同兵种协议不同建议使用宏定义
   | data_length | 1        | 1        | 数据帧中 data 的长度          |
   | crc_check   | 3        | 1        | 帧头CRC校验                   |

3.  数据段data (n-byte)

   | 数据           | 偏移位置  | 字节大小         | 内容                                  |
   | -------------- | -------- | --------------- | ------------------------------------- |
   | tx_buf_data    |          | n               |                                       |

4. frame_tail(CRC8，整包校验)

## 三、协议接口说明

```c
/*更新发送数据帧，并计算发送数据帧长度*/
void get_protocol_send_data(Vision_Send_s *tx_buf_data,     // 待发送的数据
                            uint8_t       *tx_buf,          // 待发送的数据帧
                            uint8_t       *tx_buf_len);      // 待发送的数据帧长度
```

```c
/*接收数据处理*/
uint16_t get_protocol_info(uint8_t *rx_buf,          // 接收到的原始数据
                           uint8_t *rx_data)         // 接收的数据存储地址
```
